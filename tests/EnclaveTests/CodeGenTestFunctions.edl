// Copyright (c) Microsoft Corporation.
// Licensed under the MIT License.
// File used for testing purposes

enclave
{
    /***************************************************************************************************
    *    Note about the count and size attribute on function parameters and struct fields:             *
    *                                                                                                  *
    *    [count=<value>] :  Is used to tell the codegen to copy count * sizeof(type) bytes of data     *
    *                       when copying a parameter/field  between virtual trust layers.              *
    *                                                                                                  *
    *    [size=<value>]  :  Is used to tell the codegen to copy size amount of data in bytes when      *    
    *                       copying a parameter/field between virtual trust layers.                    *
    *                                                                                                  *
    ****************************************************************************************************/

    // Anonymous enum
    enum
    {
        value1 = 10,
        value2 = 50,
    };

    // Hexidecimal enum example
     enum HexEnum 
     {
        Hex_val1 = 0x01,
        Hex_val2,
        Hex_val3,
    };

    // Decimal enum example
    enum DecimalEnum 
     {
        Deci_val1,
        Deci_val2,
        Deci_val3,
    };

    struct NestedStructWithArray
    {
        int64_t array1[value1];
    };

    struct NestedStructWithVectors
    {
        vector<NestedStructWithArray> value_in_nested_struct;
    };

    struct TestStruct1
    {
        bool bool_val;
        int8_t int8_val;
        int16_t int16_val;
        int32_t int32_val;
        int64_t int64_val;
        uint8_t uint8_val;
        uint16_t uint16_val;
        uint32_t uint32_val;
        uint64_t uint64_val;
        
        HexEnum hex_val;
        DecimalEnum deci_val;
        int64_t array1[5];

        HRESULT result;
    };

    struct TestStruct2
    {
        NestedStructWithArray field1;
        NestedStructWithVectors field2;
    };

    struct TestStruct3
    {
        TestStruct1 field1;
        TestStruct2 field2;
        vector<TestStruct2> field3;
        TestStruct1 field4[value2];
        TestStruct2 field5;
    };

    // Host to enclave functions
    trusted
    {
        HRESULT PassingPrimitivesAsValues_To_Enclave(
            bool bool_val,
            DecimalEnum enum_val,
            int8_t int8_val);

        uint64_t ReturnUint64Val_From_Enclave();

        TestStruct1 ReturnStructWithValues_From_Enclave();

        vector<TestStruct1> ReturnObjectInVector_From_Enclave();

        HRESULT PassingPrimitivesInVector_To_Enclave(
            [in] vector<int8_t> arg1,
            [in] vector<int16_t> arg2,
            [in] vector<int32_t> arg3,
            [in, out] vector<int8_t> arg4,
            [in, out] vector<int16_t> arg5,
            [in, out] vector<int32_t> arg6,
            [out] vector<int8_t> arg7,
            [out] vector<int16_t> arg8,
            [out] vector<int32_t> arg9);

        TestStruct2 ComplexPassingofTypes_To_Enclave(
            TestStruct1 arg1,
            [in, out]TestStruct2 arg2,
            [out] TestStruct3 arg3,
            [in] vector<TestStruct1> arg4,
            [in, out] vector<TestStruct2> arg5,
            [out] vector<TestStruct3> arg6);

        string PassingStringTypes_To_Enclave(
            string arg1,
            [in, out]string arg2,
            [out] string arg3,
            [in] vector<string> arg4,
            [in, out] vector<string> arg5,
            [out] vector<string> arg6);

        wstring PassingWStringTypes_To_Enclave(
            wstring arg1,
            [in, out]wstring arg2,
            [out] wstring arg3,
            [in] vector<wstring> arg4,
            [in, out] vector<wstring> arg5,
            [out] vector<wstring> arg6);

        NestedStructWithArray PassingArrayTypes_To_Enclave(
            TestStruct1 arg1[2],
            [in, out]string arg2[2],
            [out] wstring arg3[2],
            [in, out]TestStruct2 arg4[2],
            [out]TestStruct3 arg5[2]);

        // Vtl1 can't test vtl0 callbacks unless we start them from vtl0. These functions
        // are just used to allow us to start the callback tests.
        HRESULT Start_PassingPrimitivesAsValues_To_HostApp_Callback_Test();
        HRESULT Start_ReturnStructWithValues_From_HostApp_Callback_Test();
        HRESULT Start_ReturnObjectInVector_From_HostApp_Callback_Test();
        HRESULT Start_ReturnUint64Val_From_HostApp_Callback_Test();
        HRESULT Start_PassingPrimitivesInVector_To_HostApp_Callback_Test();
        HRESULT Start_ComplexPassingofTypes_To_HostApp_Callback_Test();
        HRESULT Start_PassingStringTypes_To_HostApp_Callback_Test();
        HRESULT Start_PassingWStringTypes_To_HostApp_Callback_Test();
        HRESULT Start_PassingArrayTypes_To_HostApp_Callback_Test();
    };

    // Functions are the same but these are for the opposite direction.
    // (Enclave to host).
    untrusted
    {
        HRESULT PassingPrimitivesAsValues_To_HostApp(
            bool bool_val,
            DecimalEnum enum_val,
            int8_t int8_val);

        TestStruct1 ReturnStructWithValues_From_HostApp();

        vector<TestStruct1> ReturnObjectInVector_From_HostApp();

        uint64_t ReturnUint64Val_From_HostApp();

        HRESULT PassingPrimitivesInVector_To_HostApp(
            [in] vector<int8_t> arg1,
            [in] vector<int16_t> arg2,
            [in] vector<int32_t> arg3,
            [in, out] vector<int8_t> arg4,
            [in, out] vector<int16_t> arg5,
            [in, out] vector<int32_t> arg6,
            [out] vector<int8_t> arg7,
            [out] vector<int16_t> arg8,
            [out] vector<int32_t> arg9);

        TestStruct2 ComplexPassingofTypes_To_HostApp(
            TestStruct1 arg1,
            [in, out]TestStruct2 arg2,
            [out] TestStruct3 arg3,
            [in] vector<TestStruct1> arg4,
            [in, out] vector<TestStruct2> arg5,
            [out] vector<TestStruct3> arg6);

        string PassingStringTypes_To_HostApp(
            string arg1,
            [in, out]string arg2,
            [out] string arg3,
            [in] vector<string> arg4,
            [in, out] vector<string> arg5,
            [out] vector<string> arg6);

        wstring PassingWStringTypes_To_HostApp(
            wstring arg1,
            [in, out]wstring arg2,
            [out] wstring arg3,
            [in] vector<wstring> arg4,
            [in, out] vector<wstring> arg5,
            [out] vector<wstring> arg6);

        NestedStructWithArray PassingArrayTypes_To_HostApp(
            TestStruct1 arg1[2],
            [in, out]string arg2[2],
            [out] wstring arg3[2],
            [in, out]TestStruct2 arg4[2],
            [out]TestStruct3 arg5[2]);
    };
};
